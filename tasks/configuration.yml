# SPDX-FileCopyrightText: 2020 Helmholtz Centre for Environmental Research (UFZ)
# SPDX-FileCopyrightText: 2020 Helmholtz-Zentrum Dresden - Rossendorf (HZDR)
#
# SPDX-License-Identifier: Apache-2.0

---

- name: "Create SSH key pair for communicating with Runners."
  community.crypto.openssh_keypair:
    path: "/etc/gitlab-runner/gitlab_runner_key"
    type: "ed25519"
  register: gitlab_runner_ssh_key

- name: Download and install container-linux-config-transpiler
  ansible.builtin.get_url:
    url: "{{ gitlab_runner_transpiler_binary_url }}"
    dest: /usr/local/bin/ct
    mode: '0755'
    checksum: "{{ gitlab_runner_transpiler_binary_checksum }}"

- name: Place the container linux configuration on the host
  ansible.builtin.template:
    src: flatcar-linux-config.yml.j2
    dest: /etc/gitlab-runner/flatcar-linux-config.yml
    owner: root
    group: root
    mode: 0644
  notify:
    - "Transpile the flatcar linux configuration"

...
